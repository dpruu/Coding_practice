# 3. 기본문법



## ※ 데이터 베이스 만들기

- **DROP DATABASE** 를 이용해 기존의 merket_db를 삭제. 다시 실행할 경우 고려
- **CREATE DATABASE**를 이용해 market_db 생성

```sql
DROP DATABASE IF EXISTS market_db; 
CREATE DATABASE market_db;
```

- 회원 테이블 생성

```sql
USE market_db;
CREATE TABLE member -- 회원 테이블
( mem_id  		CHAR(8) NOT NULL PRIMARY KEY, -- 사용자 아이디(PK)
  mem_name    	VARCHAR(10) NOT NULL, -- 이름
  mem_number    INT NOT NULL,  -- 인원수
  addr	  		CHAR(2) NOT NULL, -- 지역(경기,서울,경남 식으로 2글자만입력)
  phone1		CHAR(3), -- 연락처의 국번(02, 031, 055 등)
  phone2		CHAR(8), -- 연락처의 나머지 전화번호(하이픈제외)
  height    	SMALLINT,  -- 평균 키
  debut_date	DATE  -- 데뷔 일자
);
```

- 구매 테이블 생성

```sql
CREATE TABLE buy -- 구매 테이블
(  num 		INT AUTO_INCREMENT NOT NULL PRIMARY KEY, -- 순번(PK)
   mem_id  	CHAR(8) NOT NULL, -- 아이디(FK)
   prod_name 	CHAR(6) NOT NULL, --  제품이름
   group_name 	CHAR(4)  , -- 분류
   price     	INT  NOT NULL, -- 가격
   amount    	SMALLINT  NOT NULL, -- 수량
   FOREIGN KEY (mem_id) REFERENCES member(mem_id)
);
```

- 데이터 입력

```sql
INSERT INTO member VALUES('TWC', '트와이스', 9, '서울', '02', '11111111', 167, '2015.10.19');
INSERT INTO buy VALUES(NULL, 'BLK', '지갑', NULL, 30, 2);
```

- 데이터 조회

```sql
SELECT * FROM member;
SELECT * FROM buy;
```



## 1. 기본 조회하기 SELECT ~ FROM

### 1) USE 문

- SELECT 문을 실행하기 앞서 먼저 데이터베이스를 지정해야 한다. DB를 지정 또는 변경을 위해 `USE 데이터베이스_이름;`을 쿼리 창에 입력
- 잘못된 데이터베이스를 입력할 경우 `error` 발생

```SQL
USE market_db;
```

### 2) SELECT 문

#### ① 기본 형식

```SQL
SELECT 열_이름
	FROM 테이블_이름
	WHERE 조건식
	GROUP BY 열_이름
	HAVING 조건식
	ORDER BY 열_이름
	LIMIT 숫자
```

- SELECT와 FROM
  - `*`는 모든 열을 의미, `FROM` 다음 테이블을 가져온다.

```SQL
USE market_db;
SELECT * FROM member;
```

- 같은 DB이기 때문에 아래의 쿼리는 동일하게 출력

```SQL
SELECT * FROM market_db.member;
SELECT * FROM member;
```

- 테이블 조회

```SQL
SELECT mem_name FROM member;
```

- 여러 개의 열을 가져오고 싶으면 콤마로 구분한다.

```SQL
SELECT addr, debut_date, mem_name FROM member;
```
- 열 이름에 별칭(alias)을 지정할 수 있다. 별칭에 공백이 있을 경우 큰따옴표로 묶어준다.

```SQL
SELECT addr, debut_date "데뷔 일자", mem_name FROM member;
```


![image-20211228141717561](markdown-images/image-20211228141717561.png)     ![image-20211228142053978](markdown-images/image-20211228142053978.png)     ![image-20211228142201186](markdown-images/image-20211228142201186.png)

#### ② 특정 조건만  조회하기

- 기본적인 WHERE 절

```SQL
SELECT 열_이름 FROM 테이블_이름 WHERE 조건식;
# OR
SELECT 열_이름
	FROM 테이블_이름
	WHERE 조건식;
```

```SQL
SELECT * FROM member WHERE mem_name = '블랙핑크';
```

```SQL
SELECT * FROM member WHERE mem_number = 4;
```

![image-20211228143425613](markdown-images/image-20211228143425613.png)

![image-20211228143452387](markdown-images/image-20211228143452387.png)

##### (1) 관계, 논리 연산자 사용

```SQL
SELECT mem_id, mem_name
	FROM member
	WHERE height <= 162;
```

```SQL
# 논리 연산자 AND
SELECT mem_name, height, mem_number
	FROM member
	WHERE height >= 165 AND mem_member > 6;
```
```SQL
# 논리 연산자 OR
SELECT mem_name, height, mem_number
	FROM member
	WHERE height >= 165 OR mem_number > 6;
```

![image-20211228143708805](markdown-images/image-20211228143708805.png)   ![image-20211228143838913](markdown-images/image-20211228143838913.png)  ![image-20211228144149120](markdown-images/image-20211228144149120.png)

##### (2) BETWEEN ~ AND

```SQL
# 논리 연산자 BETWEEN ~ AND
SELECT mem_name, height, mem_number
	FROM member
	WHERE height BETWEEN 163 AND 165;
	# WHERE height >= 163 AND height <= 165; 와 같다.
```

![image-20211228144222325](markdown-images/image-20211228144222325.png)

##### (3) IN() 

> 숫자로 구성된 데이터는 크다/작다의 범위를 지정할 수 있지만 문자로 표현되기 때문에 어느 범위에 들어 있다고 표현할 수 없다. 그렇기 때문에 OR로 일일이 써주거나 IN()을 사용해 간단하게 작성 가능.

```SQL
SELECT mem_number, addr
	FROM member
	WHERE addr IN('경기','전남','경남');
```

![image-20211228144816650](markdown-images/image-20211228144816650.png)

##### (4) LIKE()

> - 문자열의 일부 글자를 검색하려면 `LIKE`를 사용한다. 예를 들어 첫 글자가 '우'로 시작하는 회원은 '우%'로 검색 가능하다. 이때 `%`는 뒤는 무엇이든 허용한다는 의미.
> - 한 글자와 매치하기 위해서는 `언더바(_)`를 사용한다.

```SQL
SELECT * 
	FROM member
	WHERE mem_name LIKE '우%';
```

![image-20211228145046914](markdown-images/image-20211228145046914.png)

```SQL
SELECT * 
	FROM member
	WHERE mem_name LIKE '__핑크';
```

![image-20211228145222335](markdown-images/image-20211228145222335.png)

### ※ 서브 쿼리

- `SELECT`안에 또 다른 `SELECT`가 들어갈 수 있다. 이것을 서브 쿼리 혹은 하위 쿼리라고 부른다. 이름(mem_name)이 '에이핑크'인 회원의 평균 키보다 큰 회원을 검색한다고 가정해본다.

```SQL
SELECT height FROM member WHERE mem_name = '에이핑크'
```

- 해당 코드를 이용해 평균키가 164 인것을 알아냈다.

```SQL
SELECT mem_name, height FROM member WHERE height > 164
```

![image-20211228145634582](markdown-images/image-20211228145634582.png)

- 두 SQL 문을 하나로 합쳐 사용한다.

```SQL
SELECT mem_name, height FROM member
	WHERE height > (SELECT height FROM member WHERE mem_name = '에이핑크')
```

![image-20211228145634582](markdown-images/image-20211228145634582.png)

- **두 SQL문이 같은 결과를 보여주는 것을 확인할 수 있다.**



## 2. 좀 더 깊게 알아보는 SELECT 문

> 결과의 정렬을 위한 `ORDER BY`, 결과의 개수를 제한하는 `LIMIT`, 중복된 데이터를 제거하는 `DISTINCT` 을 알아본다. 또한 `GROUP BY` 절은 지정한 열의 데이터들을 같은 데이터끼리 묶어서 결과 추출한다. `HAVING` 절을 통해 조건식을 추가할 수 있다.



### 1) ORDER BY 절

> 결과의 값이나 개수에 대해서 영향을 미치지 않지만, 결과가 출력되는 순서를 조절.

```SQL
SELECT 열_이름
	FROM 테이블_이름
	WHERE 조건식
	GROUP BY 열_이름 
	HAVING 조건식
	ORDER BY 열_이름
	LIMIT 숫자
```

- `ORDER BY`는 기본값은 `ASC`로 오름차순이지만 `DESC`로 내림차순으로 설정가능

```SQL
SELECT mem_id, mem_name, debut_date
	FROM member
	ORDER BY debut_date DESC;
```

`오름차순`![image-20211228151028471](markdown-images/image-20211228151028471.png) `내림차순` ![image-20211228151235621](markdown-images/image-20211228151235621.png)

- `ORDER BY`와 `WHERE`절은 함께 사용이 가능하다.
  - 정렬 기준은 1개 열이 아니라 여러 개 복수로 지정이 가능하다. 첫 번째 지정 열로 정렬 후 동일한 경우 다음 지정 열로 정렬할 수 있다.

```SQL
SELECT mem_id, mem_name, debut_date, height
	FROM member
	WHERE height >= 164
	ORDER BY height DESC;
```
```SQL
SELECT mem_id, mem_name, debut_date, height
	FROM member
	WHERE height >= 164
	ORDER BY height DESC, debut_date ASC;
```

![image-20211228151422056](markdown-images/image-20211228151422056.png)   ![image-20211228151547911](markdown-images/image-20211228151547911.png)
